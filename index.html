<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest Todo - Productivity RPG</title>
    <style>
        /* Keep your existing styles... */
        
        /* Add this new section for CSS-only pixel art */
        /* Animation containers */
        .pixel-scene {
            background-color: #000;
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        /* Character styles */
        .pixel-character {
            position: absolute;
            bottom: 30px;
            left: 40px;
            width: 20px;
            height: 40px;
            z-index: 10;
        }
        
        /* Forge theme */
        .forge-character {
            background-color: #6d28d9;
            animation: characterIdle 0.8s steps(1) infinite;
        }
        
        .forge-character::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 2px;
            width: 16px;
            height: 10px;
            background-color: #6d28d9;
            border-radius: 50% 50% 0 0;
        }
        
        .forge-character::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: -5px;
            width: 30px;
            height: 10px;
            background-color: #6d28d9;
            clip-path: polygon(0 0, 33% 100%, 66% 100%, 100% 0);
        }
        
        .forge-anvil {
            position: absolute;
            bottom: 30px;
            left: 100px;
            width: 40px;
            height: 15px;
            background-color: #71717a;
            border-radius: 5px 5px 0 0;
            z-index: 8;
        }
        
        .forge-anvil::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 10px;
            width: 20px;
            height: 5px;
            background-color: #52525b;
        }
        
        .forge-hammer {
            position: absolute;
            bottom: 50px;
            left: 70px;
            width: 5px;
            height: 20px;
            background-color: #92400e;
            transform-origin: bottom center;
            animation: hammerSwing 1s infinite;
            z-index: 9;
        }
        
        .forge-hammer::before {
            content: '';
            position: absolute;
            top: -8px;
            left: -5px;
            width: 15px;
            height: 8px;
            background-color: #71717a;
        }
        
        .forge-spark {
            position: absolute;
            width: 5px;
            height: 5px;
            background-color: #fbbf24;
            border-radius: 50%;
            opacity: 0;
            z-index: 11;
        }
        
        .forge-spark-1 {
            bottom: 55px;
            left: 105px;
            animation: sparkFly 1s 0s infinite;
        }
        
        .forge-spark-2 {
            bottom: 55px;
            left: 105px;
            animation: sparkFly 1s 0.3s infinite;
        }
        
        .forge-spark-3 {
            bottom: 55px;
            left: 105px;
            animation: sparkFly 1s 0.6s infinite;
        }
        
        /* Magic theme */
        .magic-character {
            background-color: #8b5cf6;
            animation: characterIdle 0.8s steps(1) infinite;
        }
        
        .magic-character::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 2px;
            width: 16px;
            height: 10px;
            background-color: #8b5cf6;
            border-radius: 50% 50% 0 0;
        }
        
        .magic-character::after {
            content: '';
            position: absolute;
            top: -15px;
            left: 0;
            width: 20px;
            height: 5px;
            background-color: #a78bfa;
            clip-path: polygon(50% 0, 0 100%, 100% 100%);
        }
        
        .magic-circle {
            position: absolute;
            bottom: 20px;
            right: 60px;
            width: 40px;
            height: 10px;
            border: 2px solid #a78bfa;
            border-radius: 50%;
            opacity: 0.7;
            animation: circlePulse 2s infinite;
            z-index: 5;
        }
        
        .magic-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: #a78bfa;
            border-radius: 50%;
            opacity: 0;
            z-index: 7;
        }
        
        .magic-particle-1 {
            bottom: 40px;
            right: 70px;
            animation: particleFloat 3s 0s infinite;
        }
        
        .magic-particle-2 {
            bottom: 30px;
            right: 60px;
            animation: particleFloat 3s 1s infinite;
        }
        
        .magic-particle-3 {
            bottom: 35px;
            right: 80px;
            animation: particleFloat 3s 2s infinite;
        }
        
        /* Combat theme */
        .combat-character {
            background-color: #ef4444;
            animation: characterIdle 0.8s steps(1) infinite;
        }
        
        .combat-character::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 2px;
            width: 16px;
            height: 10px;
            background-color: #ef4444;
            border-radius: 50% 50% 0 0;
        }
        
        .combat-enemy {
            position: absolute;
            bottom: 30px;
            right: 40px;
            width: 20px;
            height: 35px;
            background-color: #71717a;
            animation: enemyIdle 0.8s steps(1) infinite;
            z-index: 8;
        }
        
        .combat-enemy::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 2px;
            width: 16px;
            height: 10px;
            background-color: #71717a;
            border-radius: 50% 50% 0 0;
        }
        
        .combat-enemy-2 {
            right: 80px;
            animation-delay: 0.2s;
        }
        
        .combat-enemy-3 {
            right: 120px;
            animation-delay: 0.4s;
        }
        
        .combat-sword {
            position: absolute;
            bottom: 50px;
            left: 60px;
            width: 25px;
            height: 5px;
            background-color: #d1d5db;
            transform-origin: left center;
            opacity: 0;
            animation: swordSlash 2s infinite;
            z-index: 9;
        }
        
        .combat-sword::after {
            content: '';
            position: absolute;
            right: -5px;
            top: -3px;
            width: 8px;
            height: 10px;
            background-color: #9ca3af;
        }
        
        /* Animation keyframes */
        @keyframes characterIdle {
            0%, 50% { transform: translateY(0); }
            25%, 75% { transform: translateY(-2px); }
        }
        
        @keyframes hammerSwing {
            0%, 10%, 100% { transform: rotate(-45deg); }
            20%, 30% { transform: rotate(30deg); }
            40%, 90% { transform: rotate(-45deg); }
        }
        
        @keyframes sparkFly {
            0%, 90%, 100% { opacity: 0; transform: translate(0, 0); }
            20%, 40% { opacity: 1; transform: translate(5px, -10px); }
            60%, 80% { opacity: 0.7; transform: translate(10px, -20px); }
        }
        
        @keyframes circlePulse {
            0%, 100% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.2); opacity: 0.9; }
        }
        
        @keyframes particleFloat {
            0%, 100% { opacity: 0; transform: translate(0, 0); }
            20%, 30% { opacity: 1; transform: translate(-10px, -15px); }
            40%, 60% { opacity: 0.8; transform: translate(-20px, -25px); }
            70%, 90% { opacity: 0.3; transform: translate(-30px, -40px); }
        }
        
        @keyframes enemyIdle {
            0%, 50% { transform: translateX(0); }
            25%, 75% { transform: translateX(2px); }
        }
        
        @keyframes swordSlash {
            0%, 80%, 100% { opacity: 0; transform: rotate(0deg); }
            10%, 20% { opacity: 1; transform: rotate(-30deg); }
            30%, 40% { opacity: 1; transform: rotate(45deg) translate(10px, -5px); }
            50%, 70% { opacity: 0.7; transform: rotate(60deg) translate(15px, -10px); }
        }
    </style>
</head>
<body>
    <!-- Keep your existing HTML... -->

    <script>
        // Keep your existing JavaScript, but update the setupAnimation function:
        
        // Set up pixel animation based on type - UPDATED to use CSS-only approach
        function setupAnimation(type) {
            const animationScene = document.getElementById('animationScene');
            animationScene.innerHTML = '';
            
            switch (type) {
                case 'forge':
                    // Create forge elements
                    const forgeCharacter = document.createElement('div');
                    forgeCharacter.className = 'pixel-character forge-character';
                    
                    const forgeAnvil = document.createElement('div');
                    forgeAnvil.className = 'forge-anvil';
                    
                    const forgeHammer = document.createElement('div');
                    forgeHammer.className = 'forge-hammer';
                    
                    // Add sparks
                    const spark1 = document.createElement('div');
                    spark1.className = 'forge-spark forge-spark-1';
                    
                    const spark2 = document.createElement('div');
                    spark2.className = 'forge-spark forge-spark-2';
                    
                    const spark3 = document.createElement('div');
                    spark3.className = 'forge-spark forge-spark-3';
                    
                    // Add elements to the scene
                    animationScene.appendChild(forgeAnvil);
                    animationScene.appendChild(forgeHammer);
                    animationScene.appendChild(spark1);
                    animationScene.appendChild(spark2);
                    animationScene.appendChild(spark3);
                    animationScene.appendChild(forgeCharacter);
                    break;
                    
                case 'magic':
                    // Create magic elements
                    const magicCharacter = document.createElement('div');
                    magicCharacter.className = 'pixel-character magic-character';
                    
                    const magicCircle = document.createElement('div');
                    magicCircle.className = 'magic-circle';
                    
                    // Add particles
                    const particle1 = document.createElement('div');
                    particle1.className = 'magic-particle magic-particle-1';
                    
                    const particle2 = document.createElement('div');
                    particle2.className = 'magic-particle magic-particle-2';
                    
                    const particle3 = document.createElement('div');
                    particle3.className = 'magic-particle magic-particle-3';
                    
                    // Add elements to the scene
                    animationScene.appendChild(magicCircle);
                    animationScene.appendChild(particle1);
                    animationScene.appendChild(particle2);
                    animationScene.appendChild(particle3);
                    animationScene.appendChild(magicCharacter);
                    break;
                    
                case 'combat':
                    // Create combat elements
                    const combatCharacter = document.createElement('div');
                    combatCharacter.className = 'pixel-character combat-character';
                    
                    // Add enemies
                    const enemy1 = document.createElement('div');
                    enemy1.className = 'combat-enemy';
                    
                    const enemy2 = document.createElement('div');
                    enemy2.className = 'combat-enemy combat-enemy-2';
                    
                    const enemy3 = document.createElement('div');
                    enemy3.className = 'combat-enemy combat-enemy-3';
                    
                    // Add sword
                    const sword = document.createElement('div');
                    sword.className = 'combat-sword';
                    
                    // Add elements to the scene
                    animationScene.appendChild(enemy1);
                    animationScene.appendChild(enemy2);
                    animationScene.appendChild(enemy3);
                    animationScene.appendChild(sword);
                    animationScene.appendChild(combatCharacter);
                    break;
            }
        }
        
        // Fix for the break time selection
        function selectBreakTime(duration) {
            // First remove selected class from all options
            document.querySelectorAll('.break-time-selector .time-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Then add selected class to the clicked option
            document.querySelector(`.break-time-selector .time-option[data-value="${duration}"]`).classList.add('selected');
            
            if (state.activePomodoro) {
                state.activePomodoro.breakDuration = duration;
            }
        }
    </script>
</body>
</html>
